# QRKot --- Благотворительный фонд

## Оглавление

1.  [Описание проекта](#описание-проекта)
2.  [Технологический стек](#технологический-стек)
3.  [Установка и запуск](#установка-и-запуск)
4.  [Аутентификация](#аутентификация)
5.  [Эндпоинты пожертвований](#эндпоинты-пожертвований)
6.  [Интеграция с Google Drive API](#интеграция-с-google-drive-api)
7.  [Интеграция с Google Sheets API](#интеграция-с-google-sheets-api)
8.  [Пример работы Google-эндпоинта](#пример-работы-google-эндпоинта)

------------------------------------------------------------------------

## Описание проекта

QRKot --- сервис благотворительного фонда для сбора пожертвований и
финансирования проектов. Проект реализован на FastAPI с использованием
SQLAlchemy и поддерживает интеграцию с Google Drive и Google Sheets.

------------------------------------------------------------------------

## Технологический стек

-   FastAPI
-   SQLAlchemy
-   PostgreSQL
-   Pydantic
-   Google Drive API
-   Google Sheets API

------------------------------------------------------------------------

## Установка и запуск

``` bash
git clone <repo_url>
cd qrkot
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
uvicorn app.main:app --reload
```

------------------------------------------------------------------------

## Аутентификация

Используется JWT-аутентификация.

Пример запроса:

``` http
POST /auth/jwt/login
```

Ответ:

``` json
{
  "access_token": "string",
  "token_type": "bearer"
}
```

------------------------------------------------------------------------

## Эндпоинты пожертвований

### Получить список пожертвований (только суперпользователь)

``` http
GET /donation/
Authorization: Bearer <token>
```

Ответ:

``` json
[
  {
    "id": 1,
    "user_id": 5,
    "full_amount": 1000,
    "invested_amount": 1000,
    "fully_invested": true,
    "create_date": "2026-02-25T19:00:00"
  }
]
```

------------------------------------------------------------------------

## Интеграция с Google Drive API

Проект автоматически создаёт Google Spreadsheet-файл в Google Drive для
отчётности по пожертвованиям.

### Настройка

1.  Создать сервисный аккаунт в Google Cloud Console.
2.  Скачать JSON-ключ.
3.  Указать путь к ключу в переменной окружения:

``` bash
GOOGLE_APPLICATION_CREDENTIALS=/path/to/service_account.json
```

4.  Предоставить сервисному аккаунту доступ к Google Drive.

------------------------------------------------------------------------

## Интеграция с Google Sheets API

После вызова соответствующего эндпоинта создаётся таблица со сводной
информацией:

-   Название проекта
-   Общая сумма
-   Дата закрытия
-   Количество дней сбора

------------------------------------------------------------------------

## Пример работы Google-эндпоинта

### Запрос

``` http
POST /google/report
Authorization: Bearer <superuser_token>
```

### Пример ответа

``` json
{
  "spreadsheet_id": "1AbCDefGhIjKlMnOpQrStUvWxYz",
  "spreadsheet_url": "https://docs.google.com/spreadsheets/d/1AbCDefGhIjKlMnOpQrStUvWxYz/edit"
}
```

### Пример структуры созданной таблицы

  Название проекта   Сумма   Дата закрытия   Дней сбора
  ------------------ ------- --------------- ------------
  Помощь котикам     5000    2026-02-20      12

------------------------------------------------------------------------

## Логика формирования отчёта

1.  Получаются закрытые проекты.
2.  Рассчитывается длительность сбора.
3.  Формируется Google Spreadsheet.
4.  Заполняется таблица через Google Sheets API.
5.  Возвращается ID и URL таблицы.

------------------------------------------------------------------------

## Переменные окружения

``` bash
DATABASE_URL=postgresql+asyncpg://user:password@localhost/db
SECRET_KEY=your_secret_key
GOOGLE_APPLICATION_CREDENTIALS=service_account.json
```

------------------------------------------------------------------------

## Авторизация доступа

Google-эндпоинт доступен только суперпользователям.

## Разработчик проекта

- [**Максимов Вячеслав**](https://github.com/LessTalkRus)
- Студент когорты 64 факультета Python-разработчик (расширенный)

Спринт 25 "Python для бизнеса"